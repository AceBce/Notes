# 深入理解计算机系统

### 1. 计算机系统漫游
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;通过跟踪hello world程序的生命周期开始对系统的学习
  1. hello程序的生命周期从源文件开始，是采用**ASCII码**表示的文本字符
> 基本思想：系统中的所有信息都是由一串比特表示的，区分不同数据的唯一方法是通过读到这些数据对象的上下文进行判断。比如在不同上下文中，一个同样的字节序列可能表示一个整数、浮点数、字符串或机器指令

  2. 程序被翻译成不同格式
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;为了在系统上执行hello.c程序，每条C语句都要被转为机器语言指令，然后把这些指令按照称为**可执行目标程序**的格式打包，并以二进制磁盘文件的形式存储
    
     这里由编译系统执行此工作。编译系统由四个阶段的程序构成：
     * 预处理阶段
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;根据字符#开头的命令，修改原始的程序，例如：#include<stdio.h>，告诉预处理器读取系统头文件stdio.h的内容，并把它直接插入程序文本中，得到hello.i程序
     * 编译阶段
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;将文本文件hello.i翻译成文本文件hello.s，它是一个汇编语言程序
     * 汇编阶段
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;汇编器(as)将hello.s翻译成机器语言指令，并将其打包为**可重定位目标程序**的格式，最后把结果保存在hello.o中，该文件是一个二进制文件
     * 链接阶段
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hello程序调用了printf函数，该函数存在于一个名为printf.o的预编译好了的目标文件中，这个文件必须被合并到hello.o程序中，链接器(ld)就负责处理这种合并，得到hello文件，它是一个可执行文件
 1. 为什么了解编译系统如何工作？
     * 优化程序性能
       &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;为了在C程序中做出好的编码选择，我们需要了解一些机器代码和编译器将不同的C语句转化为机器代码的方式。比如，switch语句是否总比if-else语句高效，一个函数的调用开销是多大？等
     * 理解链接时出现的错误
       &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;构建大型软件系统时出现的一些令人困扰的程序错误往往与链接操作有关。比如，链接器报告无法解析一个引用，静态变量和全局变量的区别是什么？静态库和动态库的区别是什么？
     * 避免安全漏洞
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;学习安全编程的第一步就是理解数据和控制信息存储在程序栈上的方式会引起的后果，汇编语言的学习将会让我们明白堆栈原理和缓冲区溢出错误
4. 处理器读并解释存储在内存中的指令
   * 系统的硬件组成
     1. 总线
       &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;贯穿整个系统的一组电子管道，它用来在各个部件间传递信息字节。总线通常被设计成传送定长的字节块，也就是**字（word）**。字中的字节数（**字长**）是一个基本的系统参数，比如4个字节(32位)，8个字节(64位)
     2. I/O设备
     &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I/O是系统与外界联系的通道，作为用户输入的鼠标键盘，用户输出的显示器，长期存放数据和程序的磁盘都是I/O设备。每个I/O设备都通过一个**控制器**或**适配器**与I/O总线相连，控制器和适配器的区别在于它们的封装不同，控制器是I/O设备本身或系统的主板上的芯片组，适配器是一块插在主板插槽上的卡，它们的功能都是在I/O总线与I/O设备之间传递信息
     3. 主存
     &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;主存是一个临时存储设备。从物理上说，主存是由一组**动态随机存取存储器**(DRAM)芯片组成，从逻辑上说，存储器是一个线性的字节数组 
     4. 处理器（CPU）
     &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CPU是解释或执行存储在主存中指令的引擎，它的核心是**程序计数器(PC)**，这是一个大小为一个字的寄存器，PC始终指向主存中的某条机器语言指令（即PC中含有该指令的地址）
     &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;处理器的执行是从程序计数器指向的内存处读取指令，解释指令中的位，执行该指令指示的简单操作，然后更新PC，使其指向下一条指令(不一定和刚刚执行的指令在内存中相邻)
     
        > 处理器的指令集架构：每条机器代码指令的效果
     处理器的微体系结构：处理器实际上是如何实现的
     
   * 运行hello程序
      1. 我们输入字符串"./hello"后，shell程序逐一把字符读入寄存器，再把它存放到内存中，现在主存中有字符串"hello" 
      2. 